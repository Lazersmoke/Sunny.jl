<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Case Study: FeI_2 ¬∑ Sunny documentation</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Sunny documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Sunny documentation</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Overview</a></li><li><a class="tocitem" href="../../quick-start/">Quick Start</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Case Study: FeI<span>$_{2}$</span></a><ul class="internal"><li><a class="tocitem" href="#Crystals-and-symmetry-analysis"><span>Crystals and symmetry analysis</span></a></li><li><a class="tocitem" href="#Spin-systems"><span>Spin systems</span></a></li><li><a class="tocitem" href="#Interactions-and-anisotropies"><span>Interactions and anisotropies</span></a></li><li class="toplevel"><a class="tocitem" href="#Calculating-structure-factor-intensities"><span>Calculating structure factor intensities</span></a></li><li><a class="tocitem" href="#Simulated-annealing"><span>Simulated annealing</span></a></li><li><a class="tocitem" href="#Dynamical-structure-factors-with-classical-dynamics"><span>Dynamical structure factors with classical dynamics</span></a></li><li><a class="tocitem" href="#Accessing-structure-factor-data"><span>Accessing structure factor data</span></a></li></ul></li><li><a class="tocitem" href="../powder_averaging/">Powder Averaging</a></li><li><a class="tocitem" href="../ising2d/">Classical Ising model</a></li></ul></li><li><a class="tocitem" href="../../library/">Library API</a></li><li><a class="tocitem" href="../../structure-factor/">Structure Factor Calculations</a></li><li><a class="tocitem" href="../../versions/">Version History</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Case Study: FeI<span>$_{2}$</span></a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Case Study: FeI<span>$_{2}$</span></a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SunnySuite/Sunny.jl/blob/main/examples/fei2_tutorial.jl" title="Edit on GitHub"><span class="docs-icon fab">ÔÇõ</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Case-Study:-FeI_{2}"><a class="docs-heading-anchor" href="#Case-Study:-FeI_{2}">Case Study: FeI<span>$_{2}$</span></a><a id="Case-Study:-FeI_{2}-1"></a><a class="docs-heading-anchor-permalink" href="#Case-Study:-FeI_{2}" title="Permalink"></a></h1><p>FeI<span>$_2$</span> is an effective spin-1 material with strong single-ion anisotropy. Quadrupolar fluctuations give rise to a single-ion bound state that cannot be described by a dipole-only model. This tutorial illustrates how to use the classical dynamics of SU(<em>N</em>) coherent state to model the magnetic behavior in FeI<span>$_2$</span>. The original study was performed in <a href="https://doi.org/10.1038/s41567-020-01110-1">Bai et al., Nature Physics 17, 467‚Äì472 (2021)</a>.</p><img src="https://raw.githubusercontent.com/SunnySuite/Sunny.jl/main/docs/src/assets/FeI2_crystal.jpg" style="float: left;" width="400"><p>The Fe atoms are arranged in stacked triangular layers. The effective spin interactions include various anisotropic exchange interactions, and a strong single-ion anisotropy:</p><p class="math-container">\[\mathcal{H}=\sum_{(i,j)} J^{\alpha\beta}_{ij} S^{\alpha}_i S^{\beta}_j - D\sum_i \left(S^z\right)^2\]</p><p>We will formulate this Hamiltonian in Sunny and then calculate its dynamic structure factor.</p><p>Begin by importing <code>Sunny</code> and <code>GLMakie</code>, a plotting package.</p><pre><code class="language-julia hljs">using Sunny, GLMakie</code></pre><p>If you see an error <code>Package &lt;X&gt; not found in current path</code>, add the package by typing <code>] add &lt;X&gt;</code> at the Julia prompt.</p><h2 id="Crystals-and-symmetry-analysis"><a class="docs-heading-anchor" href="#Crystals-and-symmetry-analysis">Crystals and symmetry analysis</a><a id="Crystals-and-symmetry-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Crystals-and-symmetry-analysis" title="Permalink"></a></h2><p>A <a href="../../library/#Sunny.Crystal"><code>Crystal</code></a> describes the crystallographic unit cell and will usually be loaded from a <code>.cif</code> file. Here, we instead build a crystal by listing all atoms and their types.</p><pre><code class="language-julia hljs">a = b = 4.05012  # Lattice constants for triangular lattice
c = 6.75214      # Spacing in the z-direction

latvecs = lattice_vectors(a, b, c, 90, 90, 120) # A 3x3 matrix of lattice vectors that
                                                 # define the conventional unit cell
positions = [[0,0,0], [1/3, 2/3, 1/4], [2/3, 1/3, 3/4]]  # Positions of atoms in fractions
                                                         # of lattice vectors
types = [&quot;Fe&quot;, &quot;I&quot;, &quot;I&quot;]
FeI2 = Crystal(latvecs, positions; types)</code></pre><pre><code class="nohighlight hljs">Crystal
HM symbol &#39;P -3 m 1&#39; (164)
Lattice params a=4.05, b=4.05, c=6.752, Œ±=90¬∞, Œ≤=90¬∞, Œ≥=120¬∞
Cell volume 95.92
Type &#39;Fe&#39;, Wyckoff 1a (point group &#39;-3m.&#39;):
   1. [0, 0, 0]
Type &#39;I&#39;, Wyckoff 2d (point group &#39;3m.&#39;):
   2. [0.3333, 0.6667, 0.25]
   3. [0.6667, 0.3333, 0.75]
</code></pre><p>Observe that Sunny inferred the space group, &#39;P -3 m 1&#39; (164) and labeled the atoms according to their point group symmetries.</p><p>Only the Fe atoms are magnetic, so we discard the I ions using <a href="../../library/#Sunny.subcrystal-Union{Tuple{N}, Tuple{Crystal, Vararg{String, N}}} where N"><code>subcrystal</code></a>.</p><pre><code class="language-julia hljs">cryst = subcrystal(FeI2, &quot;Fe&quot;)</code></pre><pre><code class="nohighlight hljs">Crystal
HM symbol &#39;P -3 m 1&#39; (164)
Lattice params a=4.05, b=4.05, c=6.752, Œ±=90¬∞, Œ≤=90¬∞, Œ≥=120¬∞
Cell volume 95.92
Type &#39;Fe&#39;, Wyckoff 1a (point group &#39;-3m.&#39;):
   1. [0, 0, 0]
</code></pre><p>Importantly, <code>cryst</code> retains the spacegroup symmetry of the full FeI<span>$_2$</span> crystal. This information will be used, for example, to propagate exchange interactions between symmetry-equivalent bonds.</p><h2 id="Spin-systems"><a class="docs-heading-anchor" href="#Spin-systems">Spin systems</a><a id="Spin-systems-1"></a><a class="docs-heading-anchor-permalink" href="#Spin-systems" title="Permalink"></a></h2><p>To simulate a system of many spins, construct a <a href="../../library/#Sunny.System-Tuple{Crystal, Tuple{Int64, Int64, Int64}, Vector{SpinInfo}, Symbol}"><code>System</code></a>.</p><pre><code class="language-julia hljs">sys = System(cryst, (4,4,4), [SpinInfo(1,S=1)], :SUN, seed=2)</code></pre><pre><code class="nohighlight hljs">System [SU(3)]
Cell size 1, Lattice size (4, 4, 4)
</code></pre><p>The system includes <span>$4√ó4√ó4$</span> unit cells, i.e. 64 Fe atoms, each with spin <span>$S=1$</span>. The default <span>$g$</span>-factor is 2, but this could be overriden with an additional argument to <a href="../../library/#Sunny.SpinInfo"><code>SpinInfo</code></a>. Spin <span>$S=1$</span> involves a superposition of <span>$2S+1=3$</span> distinct angular momentum states. In <code>:SUN</code> mode, this superposition will be modeled using the formalism of SU(3) coherent states, which captures both dipolar and quadrupolar fluctuations. For the more traditional dipole dynamics, use <code>:dipole</code> mode instead.</p><h2 id="Interactions-and-anisotropies"><a class="docs-heading-anchor" href="#Interactions-and-anisotropies">Interactions and anisotropies</a><a id="Interactions-and-anisotropies-1"></a><a class="docs-heading-anchor-permalink" href="#Interactions-and-anisotropies" title="Permalink"></a></h2><h3 id="Symmetry-analysis"><a class="docs-heading-anchor" href="#Symmetry-analysis">Symmetry analysis</a><a id="Symmetry-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Symmetry-analysis" title="Permalink"></a></h3><p>The next step is to add interactions to the system. The command <a href="../../library/#Sunny.print_symmetry_table-Tuple{Crystal, Any}"><code>print_symmetry_table</code></a> shows all symmetry-allowed interactions up to a cutoff distance.</p><pre><code class="language-julia hljs">print_symmetry_table(cryst, 8.0)</code></pre><pre><code class="nohighlight hljs">Atom 1
Type &#39;Fe&#39;, position [0, 0, 0], multiplicity 1
Allowed g-tensor: | A  0  0 |
                  | 0  A  0 |
                  | 0  0  B |
Allowed anisotropy in Stevens operators ùí™[k,q]:
    c‚ÇÅ*ùí™[2,0] +
    c‚ÇÇ*ùí™[4,-3] + c‚ÇÉ*ùí™[4,0] +
    c‚ÇÑ*ùí™[6,-3] + c‚ÇÖ*ùí™[6,0] + c‚ÇÜ*ùí™[6,6]

Bond(1, 1, [1, 0, 0])
Distance 4.05012, coordination 6
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [1, 0, 0]
Allowed exchange matrix: | A  0  0 |
                         | 0  B  D |
                         | 0  D  C |

Bond(1, 1, [0, 0, 1])
Distance 6.75214, coordination 2
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [0, 0, 1]
Allowed exchange matrix: | A  0  0 |
                         | 0  A  0 |
                         | 0  0  B |

Bond(1, 1, [1, 2, 0])
Distance 7.01501361675086, coordination 6
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [1, 2, 0]
Allowed exchange matrix: | A  0  0 |
                         | 0  B  D |
                         | 0  D  C |

Bond(1, 1, [1, 0, 1])
Distance 7.8736818956572, coordination 12
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [1, 0, 1]
Allowed exchange matrix: | A  F  E |
                         | F  B  D |
                         | E  D  C |

</code></pre><p>The allowed <span>$g$</span>-tensor is expressed as a 3√ó3 matrix in the free coefficients <code>A</code>, <code>B</code>, ... The allowed single-ion anisotropy is expressed as a linear combination of Stevens operators. The latter correspond to polynomials of the spin operators, as we will describe below.</p><p>The allowed exchange interactions are given as a 3√ó3 matrix for representative bonds. The notation <code>Bond(i, j, n)</code> indicates a bond between atom indices <code>i</code> and <code>j</code>, with cell offset <code>n</code>. In the general case, it will be necessary to associate atom indices with their positions in the unit cell; these can be viewed with <code>display(cryst)</code>. Note that the order of the pair <span>$(i, j)$</span> is significant if the exchange tensor contains antisymmetric Dzyaloshinskii‚ÄìMoriya (DM) interactions.</p><p>In the case of FeI<span>$_2$</span>, <code>Bond(1, 1, [1,0,0])</code> is one of the 6 nearest-neighbor Fe-Fe bonds on a triangular lattice layer, and <code>Bond(1, 1, [0,0,1])</code> is an Fe-Fe bond between layers.</p><h3 id="Assigning-interactions-and-anisotropies"><a class="docs-heading-anchor" href="#Assigning-interactions-and-anisotropies">Assigning interactions and anisotropies</a><a id="Assigning-interactions-and-anisotropies-1"></a><a class="docs-heading-anchor-permalink" href="#Assigning-interactions-and-anisotropies" title="Permalink"></a></h3><p>The function <a href="../../library/#Sunny.set_exchange!-Union{Tuple{N}, Tuple{System{N}, Any, Bond}} where N"><code>set_exchange!</code></a> assigns an exchange interaction to a bond, and will propagate the interaction to all symmetry-equivalent bonds in the unit cell. The FeI<span>$_2$</span> interactions below follow <a href="https://doi.org/10.1038/s41567-020-01110-1">Bai et al</a>.</p><pre><code class="language-julia hljs">J1pm   = -0.236
J1pmpm = -0.161
J1zpm  = -0.261
J2pm   = 0.026
J3pm   = 0.166
J‚Ä≤0pm  = 0.037
J‚Ä≤1pm  = 0.013
J‚Ä≤2apm = 0.068

J1zz   = -0.236
J2zz   = 0.113
J3zz   = 0.211
J‚Ä≤0zz  = -0.036
J‚Ä≤1zz  = 0.051
J‚Ä≤2azz = 0.073

J1xx = J1pm + J1pmpm
J1yy = J1pm - J1pmpm
J1yz = J1zpm

set_exchange!(sys, [J1xx   0.0    0.0;
                    0.0    J1yy   J1yz;
                    0.0    J1yz   J1zz], Bond(1,1,[1,0,0]))
set_exchange!(sys, [J2pm   0.0    0.0;
                    0.0    J2pm   0.0;
                    0.0    0.0    J2zz], Bond(1,1,[1,2,0]))
set_exchange!(sys, [J3pm   0.0    0.0;
                    0.0    J3pm   0.0;
                    0.0    0.0    J3zz], Bond(1,1,[2,0,0]))
set_exchange!(sys, [J‚Ä≤0pm  0.0    0.0;
                    0.0    J‚Ä≤0pm  0.0;
                    0.0    0.0    J‚Ä≤0zz], Bond(1,1,[0,0,1]))
set_exchange!(sys, [J‚Ä≤1pm  0.0    0.0;
                    0.0    J‚Ä≤1pm  0.0;
                    0.0    0.0    J‚Ä≤1zz], Bond(1,1,[1,0,1]))
set_exchange!(sys, [J‚Ä≤2apm 0.0    0.0;
                    0.0    J‚Ä≤2apm 0.0;
                    0.0    0.0    J‚Ä≤2azz], Bond(1,1,[1,2,1]))</code></pre><p>The function <a href="../../library/#Sunny.set_anisotropy!-Union{Tuple{N}, Tuple{System{N}, MultivariatePolynomials.AbstractPolynomialLike, Int64}} where N"><code>set_anisotropy!</code></a> assigns a single-ion anisotropy. It takes an abstract operator and an atom index. The operator may be a polynomial of spin operators or a linear combination of Stevens operators. Sunny provides special symbols for their construction: <a href="../../library/#Sunny.ùíÆ"><code>ùíÆ</code></a> is a vector of the three spin operators and <a href="../../library/#Sunny.ùí™"><code>ùí™</code></a> are the symbolic Stevens operators. Here we construct an easy-axis anisotropy.</p><pre><code class="language-julia hljs">D = 2.165
set_anisotropy!(sys, -D*ùíÆ[3]^2, 1)</code></pre><p>Any anisotropy operator can be converted to a linear combination of Stevens operators with <a href="../../library/#Sunny.print_anisotropy_as_stevens-Tuple{Any}"><code>print_anisotropy_as_stevens</code></a>.</p><h1 id="Calculating-structure-factor-intensities"><a class="docs-heading-anchor" href="#Calculating-structure-factor-intensities">Calculating structure factor intensities</a><a id="Calculating-structure-factor-intensities-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-structure-factor-intensities" title="Permalink"></a></h1><p>In the remainder of this tutorial, we will examine Sunny&#39;s tools for calculating structure factors using generalized SU(<em>N</em>) classical dynamics. This will involve the sampling of spin configurations from the Boltzmann distribution at a finite temperature. Spin-spin correlations measured dynamically then provide an estimate of the structure factor <span>$\mathcal{S}^{\alpha\beta}(\mathbf{q},\omega)$</span>.</p><h2 id="Simulated-annealing"><a class="docs-heading-anchor" href="#Simulated-annealing">Simulated annealing</a><a id="Simulated-annealing-1"></a><a class="docs-heading-anchor-permalink" href="#Simulated-annealing" title="Permalink"></a></h2><p>The <a href="https://arxiv.org/abs/2209.01265">Langevin dynamics of SU(<em>N</em>) coherent states</a> can be used to sample spin configurations in thermal equlibrium. Begin by constructing a <a href="../../library/#Sunny.Langevin"><code>Langevin</code></a> object.</p><pre><code class="language-julia hljs">Œît = 0.05/D    # Single-ion anisotropy is the strongest interaction, so 1/D is</code></pre><pre><code class="nohighlight hljs">0.023094688221709007</code></pre><p>a natural dynamical time-scale (in units with ƒß=1).</p><pre><code class="language-julia hljs">Œª = 0.1        # Dimensionless magnitude of coupling to thermal bath
langevin = Langevin(Œît; kT=0, Œª);</code></pre><p>Attempt to find a low-energy spin configuration by lowering the temperature kT from 2 to 0 using 20,000 Langevin time-steps.</p><pre><code class="language-julia hljs">randomize_spins!(sys)
for kT in range(2, 0, 20_000)
    langevin.kT = kT
    step!(sys, langevin)
end</code></pre><p>Because the quench was relatively fast, it is expected to find defects in the magnetic order. These can be visualized.</p><pre><code class="language-julia hljs">plot_spins(sys; arrowlength=2.5, linewidth=0.75, arrowsize=1.5)</code></pre><p><img src="../fei2_tutorial-31.png" alt/></p><p>If we had used a slower annealing procedure, involving 100,000 or more Langevin time-steps, it would very likely find the correct ground state. Instead, for purposes of illustration, let&#39;s analyze the imperfect spin configuration currently stored in <code>sys</code>.</p><p>An experimental probe of magnetic order order is the &#39;instantaneous&#39; or &#39;static&#39; structure factor intensity, available via <a href="../../library/#Sunny.InstantStructureFactor-Tuple{System}"><code>InstantStructureFactor</code></a> and related functions. To infer periodicities of the magnetic supercell, however, it is sufficient to look at the structure factor weights of spin sublattices individually, <em>without</em> phase averaging. This information is provided by <a href="../../library/#Sunny.print_wrapped_intensities-Union{Tuple{System{N}}, Tuple{N}} where N"><code>print_wrapped_intensities</code></a> (see the API documentation for a physical interpretation).</p><pre><code class="language-julia hljs">print_wrapped_intensities(sys)</code></pre><pre><code class="nohighlight hljs">Dominant wavevectors for spin sublattices:

    [0, -1/4, 1/4]         49.79% weight
    [0, 1/4, -1/4]         49.79%
    [1/4, 0, 1/2]           0.02%
    [-1/4, 0, 1/2]          0.02%
    [-1/4, 1/4, 1/4]        0.02%
    [1/4, -1/4, -1/4]       0.02%
    [0, 0, 0]               0.01%
    [1/4, 1/4, 1/2]         0.01%
    [-1/4, -1/4, 1/2]       0.01%
    [-1/4, 1/2, 1/4]        0.01%
    [1/4, 1/2, -1/4]        0.01%
    ...                     ...
</code></pre><p>The above is consistent with known results. The zero-field energy-minimizing magnetic structure of FeI<span>$_2$</span> is single-<span>$q$</span>. If annealing were perfect, then spontaneous symmetry breaking would select one of <span>$¬±q = [0, -1/4, 1/4]$</span>, <span>$[1/4, 0, 1/4]$</span>, or <span>$[-1/4,1/4,1/4]$</span>.</p><p>Let&#39;s break the symmetry by hand. Given a list of <span>$q$</span> modes, Sunny can suggest a magnetic supercell with appropriate periodicity. The result is printed in units of the crystal lattice vectors.</p><pre><code class="language-julia hljs">suggest_magnetic_supercell([[0, -1/4, 1/4]], sys.latsize)</code></pre><pre><code class="nohighlight hljs">Suggested magnetic supercell in multiples of lattice vectors:

    [1 0 0; 0 1 -2; 0 1 2]

for wavevectors [[0, -1/4, 1/4]].
</code></pre><p>The function <a href="../../library/#Sunny.reshape_geometry-Union{Tuple{N}, Tuple{System{N}, Any}} where N"><code>reshape_geometry</code></a> allows an arbitrary reshaping of the system. After selecting the supercell geometry, it becomes much easier to find the energy-minimizing spin configuration.</p><pre><code class="language-julia hljs">sys_supercell = reshape_geometry(sys, [1 0 0; 0 1 -2; 0 1 2])

langevin.kT = 0
for i in 1:10_000
    step!(sys_supercell, langevin)
end

plot_spins(sys_supercell; arrowlength=2.5, linewidth=0.75, arrowsize=1.5)</code></pre><p><img src="../fei2_tutorial-38.png" alt/></p><h2 id="Dynamical-structure-factors-with-classical-dynamics"><a class="docs-heading-anchor" href="#Dynamical-structure-factors-with-classical-dynamics">Dynamical structure factors with classical dynamics</a><a id="Dynamical-structure-factors-with-classical-dynamics-1"></a><a class="docs-heading-anchor-permalink" href="#Dynamical-structure-factors-with-classical-dynamics" title="Permalink"></a></h2><p>Working with the magnetic supercell makes annealing substantially easier. Classical simulations are conducted on a finite-sized lattice, however, and obtaining acceptable resolution in momentum space requires the use of a larger system size. This easily achieved with <code>resize_periodically</code>:</p><pre><code class="language-julia hljs">sys_large = resize_periodically(sys_supercell, (16,16,4))
plot_spins(sys_large; arrowlength=2.5, linewidth=0.75, arrowsize=1.5)</code></pre><p><img src="../fei2_tutorial-40.png" alt/></p><p>Apply Langevin dynamics to thermalize the system to a target temperature.</p><pre><code class="language-julia hljs">kT = 0.5 * meV_per_K     # 0.5K in units of meV
langevin.kT = kT

for _ in 1:10_000
    step!(sys_large, langevin)
end</code></pre><p>We can measure the <a href="../../library/#Sunny.DynamicStructureFactor-Tuple{System}"><code>DynamicStructureFactor</code></a> by integrating the <a href="https://arxiv.org/abs/2204.07563">Hamiltonian dynamics of SU(<em>N</em>) coherent states</a>. Three keyword parameters are required to determine the œâ information that will be calculated: an integration step size, the number of œâs to resolve, and the maximum œâ to resolve. For the time step, twice the value used for the Langevin integrator is usually a good choice.</p><pre><code class="language-julia hljs">sf = DynamicStructureFactor(sys_large; Œît=2Œît, nœâ=120, œâmax=7.5);</code></pre><p><code>sf</code> currently contains dynamical structure data generated from a single sample. Additional samples can be added by generating a new spin configuration and calling <a href="../../library/#Sunny.add_sample!-Tuple{StructureFactor, System}"><code>add_sample!</code></a>:</p><pre><code class="language-julia hljs">for _ in 1:2
    for _ in 1:1000               # Fewer steps needed in equilibrium
        step!(sys_large, langevin)
    end
    add_sample!(sf, sys_large)    # Accumulate the sample into `sf`
end</code></pre><h2 id="Accessing-structure-factor-data"><a class="docs-heading-anchor" href="#Accessing-structure-factor-data">Accessing structure factor data</a><a id="Accessing-structure-factor-data-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-structure-factor-data" title="Permalink"></a></h2><p>The basic function for accessing intensity data is <a href="../../library/#Sunny.intensities-Tuple{StructureFactor, Any, Any}"><code>intensities</code></a>, which, in addition to the structure factor data itself, takes a list of wave vectors and a mode parameter. The options for the mode parameter are <code>:trace</code>, <code>:perp</code> and <code>:full</code> which return, respectively, the trace, the unpolarized intensity, and the full set of matrix elements (correlations of spin components) at the specified wave vectors. An optional keyword argument <code>kT</code> enables a classical-to-quantum rescaling.</p><p>Below, we plot two single-<span>$q$</span> slices.</p><pre><code class="language-julia hljs">qs = [[0, 0, 0], [0.5, 0.5, 0.5]]
is = intensities(sf, qs, :trace; kT)

fig = Figure()
ax = Axis(fig[1,1]; xlabel=&quot;meV&quot;, ylabel=&quot;Intensity&quot;)
l1 = lines!(ax, œâs(sf), is[1,:])
l2 = lines!(ax, œâs(sf), is[2,:])
Legend(fig[1,2], [l1, l2], [&quot;(0,0,0)&quot;, &quot;(œÄ,œÄ,œÄ)&quot;])
fig</code></pre><p><img src="../fei2_tutorial-48.png" alt/></p><p>Frequently one wants to extract energy intensities along lines that connect special wave vectors. The function <a href="../../library/#Sunny.connected_path-Tuple{Vector, Any}"><code>connected_path</code></a> linearly samples between provided <span>$q$</span>-points, with a given sample density.</p><pre><code class="language-julia hljs">points = [[0,   0, 0],  # List of wave vectors that define a path
          [1,   0, 0],
          [0,   1, 0],
          [1/2, 0, 0],
          [0,   1, 0],
          [0,   0, 0]]
density = 40
path, markers = connected_path(points, density);</code></pre><p>Calculate and plot the intensities along this path using <a href="../../library/#Sunny.FormFactor-Tuple{Int64, Union{Nothing, String}}"><code>FormFactor</code></a> corrections appropriate for <code>Fe2</code> magnetic ions.</p><pre><code class="language-julia hljs">formfactors = [FormFactor(1, &quot;Fe2&quot;; g_lande=3/2)]

is = intensities(sf, path, :perp;
    interpolation = :linear,       # Interpolate between available wave vectors
    kT,                            # Temperature for intensity correction
    formfactors,                   # Form factor information
)
is = broaden_energy(sf, is, (œâ, œâ‚ÇÄ)-&gt;lorentzian(œâ-œâ‚ÇÄ, 0.06))  # Add artificial broadening

labels = [&quot;($(p[1]),$(p[2]),$(p[3]))&quot; for p in points]

heatmap(1:size(is,1), œâs(sf), is;
    colorrange=(0.0, 2.5),
    axis = (
        ylabel = &quot;meV&quot;,
        xticks = (markers, labels),
        xticklabelrotation=œÄ/8,
        xticklabelsize=12,
    )
)</code></pre><p><img src="../fei2_tutorial-52.png" alt/></p><p>The existence of a lower-energy, single-ion bound state is in qualitative agreement with the experimental data in <a href="https://doi.org/10.1038/s41567-020-01110-1">Bai et al.</a> (Note that the publication figure uses a different coordinate system to label the same wave vectors.)</p><img src="https://raw.githubusercontent.com/SunnySuite/Sunny.jl/main/docs/src/assets/FeI2_intensity.jpg"><p>Often it is useful to plot cuts across multiple wave vectors but at a single energy.</p><pre><code class="language-julia hljs">npoints = 60
qvals = range(-2, 2, length=npoints)
qs = [[a, b, 0] for a in qvals, b in qvals]

is = intensities(sf, qs, :perp;
    interpolation = :linear,
    kT,
    formfactors,
);

œâidx = 30
œâ = œâs(sf)[œâidx]
fig = Figure()
ax = Axis(fig[1,1]; title=&quot;œâ=$œâ meV&quot;, aspect=true)
hidedecorations!(ax); hidespines!(ax)
hm = heatmap!(ax, is[:,:,œâidx])
Colorbar(fig[1,2], hm)
fig</code></pre><p><img src="../fei2_tutorial-54.png" alt/></p><p>Note that Brillouin zones appear &#39;skewed&#39;. This is a consequence of the fact that Sunny measures <span>$q$</span>-vectors as multiples of reciprocal lattice vectors, and the latter are not orthogonal. It is often useful to express our wave vectors in terms of an orthogonal basis, where each basis element is specified as a linear combination of reciprocal lattice vectors. For our crystal, with reciprocal vectors <span>$a^*$</span>, <span>$b^*$</span> and <span>$c^*$</span>, we can define an orthogonal basis by taking <span>$\hat{a}^* = 0.5(a^* + b^*)$</span>, <span>$\hat{b}^*=a^* - b^*$</span>, and <span>$\hat{c}^*=c^*$</span>. Below, we map <code>qs</code> to wavevectors <code>ks</code> in the new coordinate system and get their intensities.</p><pre><code class="language-julia hljs">A = [0.5  1  0;
     0.5 -1  0;
     0    0  1]
ks = [A*q for q in qs]

is_ortho = intensities(sf, ks, :perp;
    interpolation = :linear,
    kT,
    formfactors,
)

fig = Figure()
ax = Axis(fig[1,1]; title=&quot;œâ=$œâ meV&quot;, aspect=true)
hidedecorations!(ax); hidespines!(ax)
hm = heatmap!(ax, is_ortho[:,:,œâidx])
Colorbar(fig[1,2], hm)
fig</code></pre><p><img src="../fei2_tutorial-56.png" alt/></p><p>Finally, we note that instantaneous structure factor data, <span>$ùíÆ(ùê™)$</span>, can be obtained from a dynamic structure factor with <a href="../../library/#Sunny.instant_intensities-Tuple{StructureFactor, Any, Any}"><code>instant_intensities</code></a>.</p><pre><code class="language-julia hljs">is_static = instant_intensities(sf, ks, :perp;
    interpolation = :linear,
    kT,
    formfactors,
)

fig = Figure()
ax = Axis(fig[1,1]; title=&quot;Instantaneous Structure Factor&quot;, aspect=true)
hidedecorations!(ax); hidespines!(ax)
hm = heatmap!(ax, is_static)
Colorbar(fig[1,2], hm)
fig</code></pre><p><img src="../fei2_tutorial-58.png" alt/></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../quick-start/">¬´ Quick Start</a><a class="docs-footer-nextpage" href="../powder_averaging/">Powder Averaging ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 27 April 2023 19:50">Thursday 27 April 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
