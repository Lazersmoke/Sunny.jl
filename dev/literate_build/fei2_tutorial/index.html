<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Case Study: FeI_2 ¬∑ Sunny documentation</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Sunny documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Sunny documentation</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Overview</a></li><li><a class="tocitem" href="../../quick-start/">Quick Start</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Case Study: FeI<span>$_{2}$</span></a><ul class="internal"><li><a class="tocitem" href="#Crystals-and-symmetry-analysis"><span>Crystals and symmetry analysis</span></a></li><li><a class="tocitem" href="#Spin-systems"><span>Spin systems</span></a></li><li><a class="tocitem" href="#Interactions-and-anisotropies"><span>Interactions and anisotropies</span></a></li><li class="toplevel"><a class="tocitem" href="#Calculating-a-dynamical-spin-structure-factor"><span>Calculating a dynamical spin structure factor</span></a></li><li><a class="tocitem" href="#Finding-a-ground-state"><span>Finding a ground state</span></a></li><li><a class="tocitem" href="#Calculating-the-structure-factor"><span>Calculating the structure factor</span></a></li><li><a class="tocitem" href="#Accessing-structure-factor-data"><span>Accessing structure factor data</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../library/">Library API</a></li><li><a class="tocitem" href="../../structure-factor/">Structure Factor Calculations</a></li><li><a class="tocitem" href="../../versions/">Version History</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Case Study: FeI<span>$_{2}$</span></a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Case Study: FeI<span>$_{2}$</span></a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SunnySuite/Sunny.jl/blob/main/examples/fei2_tutorial.jl" title="Edit on GitHub"><span class="docs-icon fab">ÔÇõ</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Case-Study:-FeI_{2}"><a class="docs-heading-anchor" href="#Case-Study:-FeI_{2}">Case Study: FeI<span>$_{2}$</span></a><a id="Case-Study:-FeI_{2}-1"></a><a class="docs-heading-anchor-permalink" href="#Case-Study:-FeI_{2}" title="Permalink"></a></h1><p>FeI<span>$_{2}$</span> is an effective spin-1 material with strong single-ion anisotropy, making it an excellent candidate for treatment with SU(3) spin dynamics. In particular, one of the elementary excitations of the system can only be captured clasically with an SU(3) treatment. A magnon, clearly visible in the experimental data, would simply be absent if we were to employ traditional Landau-Lifshitz dynamics or SU(2) spin wave theory. Full details about the model can be found in reference [1].</p><p>The model contains a number of competing, anisotropic exchange interactions together with a strong single-ion anisotropy. Writing the exchange terms in the most general way, the Hamiltonian has the form:</p><p class="math-container">\[\mathcal{H}=\sum_{(i,j)} J^{\alpha\beta}_{ij} S^{\alpha}_i S^{\beta}_j - D\sum_i \left(S^z\right)^2\]</p><p>We will calculate a dynamic structure factor using this model. We begin by importing the required packages, starting with <code>Sunny</code>. We will also add <code>GLMakie</code>, a plotting package. If you see <code>Package X not found in current path</code>, you can install the package by entering <code>using Pkg; pkg&quot;add X&quot;</code> in the Julia REPL.</p><pre><code class="language-julia hljs">using Sunny, LinearAlgebra, GLMakie</code></pre><h2 id="Crystals-and-symmetry-analysis"><a class="docs-heading-anchor" href="#Crystals-and-symmetry-analysis">Crystals and symmetry analysis</a><a id="Crystals-and-symmetry-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Crystals-and-symmetry-analysis" title="Permalink"></a></h2><p>One begins by constructing a <a href="../../library/#Sunny.Crystal"><code>Crystal</code></a> that describes the crystallographic unit cell. Frequently, the crystal will be loaded from a <code>.cif</code> file. Below, we construct the crystal by providing a full list of all atoms in the conventional unit cell.</p><pre><code class="language-julia hljs">a = b = 4.05012  # Lattice constants for triangular lattice
c = 6.75214      # Spacing in the z-direction

lat_vecs = lattice_vectors(a, b, c, 90, 90, 120) # A 3x3 matrix of lattice vectors that
                                                 # define the conventional unit cell
basis_vecs = [[0,0,0], [1/3, 2/3, 1/4], [2/3, 1/3, 3/4]]  # Positions of atoms in fractions
                                                          # of lattice vectors
types = [&quot;Fe&quot;, &quot;I&quot;, &quot;I&quot;]
FeI2 = Crystal(lat_vecs, basis_vecs; types)</code></pre><pre><code class="nohighlight hljs">Crystal
HM symbol &#39;P -3 m 1&#39; (164)
Lattice params a=4.05, b=4.05, c=6.752, Œ±=90¬∞, Œ≤=90¬∞, Œ≥=120¬∞
Cell volume 95.92
Type &#39;Fe&#39;, Wyckoff 1a (point group &#39;-3m.&#39;):
   1. [0, 0, 0]
Type &#39;I&#39;, Wyckoff 2d (point group &#39;3m.&#39;):
   2. [0.3333, 0.6667, 0.25]
   3. [0.6667, 0.3333, 0.75]
</code></pre><p>Observe that Sunny indentified the correct space group, &#39;P -3 m 1&#39; (164), in agreement with Ref. [1].</p><p>Only the Fe atoms are magnetic, so we discard the I ions using <a href="../../library/#Sunny.subcrystal-Union{Tuple{N}, Tuple{Crystal, Vararg{String, N}}} where N"><code>subcrystal</code></a>.</p><pre><code class="language-julia hljs">cryst = subcrystal(FeI2, &quot;Fe&quot;)</code></pre><pre><code class="nohighlight hljs">Crystal
HM symbol &#39;P -3 m 1&#39; (164)
Lattice params a=4.05, b=4.05, c=6.752, Œ±=90¬∞, Œ≤=90¬∞, Œ≥=120¬∞
Cell volume 95.92
Type &#39;Fe&#39;, Wyckoff 1a (point group &#39;-3m.&#39;):
   1. [0, 0, 0]
</code></pre><p>Importantly, <code>cryst</code> retains the spacegroup symmetry information for the full FeI2 crystal. This information will be used, for example, to propagate exchange interactions by symmetry.</p><h2 id="Spin-systems"><a class="docs-heading-anchor" href="#Spin-systems">Spin systems</a><a id="Spin-systems-1"></a><a class="docs-heading-anchor-permalink" href="#Spin-systems" title="Permalink"></a></h2><p>The FeI2 unit cell contains only a single Fe atom. To simulate a system of many spins, construct a <a href="../../library/#Sunny.System-Tuple{Crystal, Tuple{Int64, Int64, Int64}, Vector{SpinInfo}, Symbol}"><code>System</code></a>.</p><pre><code class="language-julia hljs">sys = System(cryst, (4,4,4), [SpinInfo(1,S=1)], :SUN, seed=0)</code></pre><pre><code class="nohighlight hljs">System [SU(3)]
Cell size 1, Lattice size (4, 4, 4)
</code></pre><p>This system includes <span>$4√ó4√ó4$</span> unit cells, i.e. 64 spin moments, each with spin <span>$S=1$</span>. The default <span>$g$</span>-factor is 2, but this could be overriden with an additional argument to <a href="../../library/#Sunny.SpinInfo"><code>SpinInfo</code></a>. Recall that spin-1 has <span>$N=2S+1=3$</span> distinct angular momentum states. Because we selected <code>:SUN</code> mode, Sunny will simulate the dynamics of SU(3) coherent states, which includes both dipolar and quadrupolar fluctuations. For the more traditional dipole dynamics, use mode <code>:dipole</code> instead.</p><h2 id="Interactions-and-anisotropies"><a class="docs-heading-anchor" href="#Interactions-and-anisotropies">Interactions and anisotropies</a><a id="Interactions-and-anisotropies-1"></a><a class="docs-heading-anchor-permalink" href="#Interactions-and-anisotropies" title="Permalink"></a></h2><h3 id="Symmetry-analysis"><a class="docs-heading-anchor" href="#Symmetry-analysis">Symmetry analysis</a><a id="Symmetry-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Symmetry-analysis" title="Permalink"></a></h3><p>The next step is to add interactions to the system. The command <a href="../../library/#Sunny.print_symmetry_table-Tuple{Crystal, Any}"><code>print_symmetry_table</code></a> shows all symmetry-allowed interactions up to a distance cutoff.</p><pre><code class="language-julia hljs">print_symmetry_table(cryst, 8.0)</code></pre><pre><code class="nohighlight hljs">Site 1
Type &#39;Fe&#39;, position [0, 0, 0], multiplicity 1
Allowed g-tensor: | A  0  0 |
                  | 0  A  0 |
                  | 0  0  B |
Allowed anisotropy in Stevens operators ùí™[k,q]:
    c‚ÇÅ*ùí™[2,0] +
    c‚ÇÇ*ùí™[4,-3] + c‚ÇÉ*ùí™[4,0] +
    c‚ÇÑ*ùí™[6,-3] + c‚ÇÖ*ùí™[6,0] + c‚ÇÜ*ùí™[6,6]

Bond(1, 1, [1, 0, 0])
Distance 4.05012, coordination 6
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [1, 0, 0]
Allowed exchange matrix: | A  0  0 |
                         | 0  B  D |
                         | 0  D  C |

Bond(1, 1, [0, 0, 1])
Distance 6.75214, coordination 2
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [0, 0, 1]
Allowed exchange matrix: | A  0  0 |
                         | 0  A  0 |
                         | 0  0  B |

Bond(1, 1, [1, 2, 0])
Distance 7.01501361675086, coordination 6
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [1, 2, 0]
Allowed exchange matrix: | A  0  0 |
                         | 0  B  D |
                         | 0  D  C |

Bond(1, 1, [1, 0, 1])
Distance 7.8736818956572, coordination 12
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [1, 0, 1]
Allowed exchange matrix: | A  F  E |
                         | F  B  D |
                         | E  D  C |

</code></pre><p>The allowed <span>$g$</span>-tensor is expressed as a 3√ó3 matrix in the free coefficients <code>A</code>, <code>B</code>, ... The allowed single-ion anisotropy is expressed as a linear combination of Stevens operators. The latter correspond to polynomials of the spin operators, as we will describe below.</p><p>The allowed exchange interactions are given as a 3√ó3 matrix for representative bonds. The notation <code>Bond(i, j, n)</code> indicates a bond between atom indices <code>i</code> and <code>j</code>, with cell offset <code>n</code>. In the general case, it will be necessary to associate atom indices with their positions in the unit cell; these can be viewed with <code>display(cryst)</code>. Note that the order of the pair <span>$(i, j)$</span> is significant if the exchange tensor contains antisymmetric Dzyaloshinskii‚ÄìMoriya (DM) interactions.</p><p>As an example, <code>Bond(1, 1, [1,0,0])</code> involves an offset of one unit cell in the direction of the first lattice vector. In the case of FeI2, this is one of the 6 nearest-neighbor Fe-Fe bonds on the triangular lattice.</p><h3 id="Assigning-interactions-and-anisotropies"><a class="docs-heading-anchor" href="#Assigning-interactions-and-anisotropies">Assigning interactions and anisotropies</a><a id="Assigning-interactions-and-anisotropies-1"></a><a class="docs-heading-anchor-permalink" href="#Assigning-interactions-and-anisotropies" title="Permalink"></a></h3><p>The function <a href="../../library/#Sunny.set_exchange!-Union{Tuple{N}, Tuple{System{N}, Any, Bond}} where N"><code>set_exchange!</code></a> assigns an exchange interaction to a bond, and will propagate the interaction to all symmetry-equivalent bonds in the unit cell. Below we define the FeI2 interactions following Ref. [1].</p><pre><code class="language-julia hljs">J1pm   = -0.236
J1pmpm = -0.161
J1zpm  = -0.261
J2pm   = 0.026
J3pm   = 0.166
J‚Ä≤0pm  = 0.037
J‚Ä≤1pm  = 0.013
J‚Ä≤2apm = 0.068

J1zz   = -0.236
J2zz   = 0.113
J3zz   = 0.211
J‚Ä≤0zz  = -0.036
J‚Ä≤1zz  = 0.051
J‚Ä≤2azz = 0.073

J1xx = J1pm + J1pmpm
J1yy = J1pm - J1pmpm
J1yz = J1zpm

set_exchange!(sys, [J1xx   0.0    0.0;
                    0.0    J1yy   J1yz;
                    0.0    J1yz   J1zz], Bond(1,1,[1,0,0]))
set_exchange!(sys, [J2pm   0.0    0.0;
                    0.0    J2pm   0.0;
                    0.0    0.0    J2zz], Bond(1,1,[1,2,0]))
set_exchange!(sys, [J3pm   0.0    0.0;
                    0.0    J3pm   0.0;
                    0.0    0.0    J3zz], Bond(1,1,[2,0,0]))
set_exchange!(sys, [J‚Ä≤0pm  0.0    0.0;
                    0.0    J‚Ä≤0pm  0.0;
                    0.0    0.0    J‚Ä≤0zz], Bond(1,1,[0,0,1]))
set_exchange!(sys, [J‚Ä≤1pm  0.0    0.0;
                    0.0    J‚Ä≤1pm  0.0;
                    0.0    0.0    J‚Ä≤1zz], Bond(1,1,[1,0,1]))
set_exchange!(sys, [J‚Ä≤2apm 0.0    0.0;
                    0.0    J‚Ä≤2apm 0.0;
                    0.0    0.0    J‚Ä≤2azz], Bond(1,1,[1,2,1]))</code></pre><p>The function <a href="../../library/#Sunny.set_anisotropy!-Union{Tuple{N}, Tuple{System{N}, MultivariatePolynomials.AbstractPolynomialLike, Int64}} where N"><code>set_anisotropy!</code></a> assigns a single-ion anisotropy. It takes an abstract operator and an atom index. The operator may be a polynomial of spin operators or a linear combination of Stevens operators. Sunny provides special symbols for their construction: <a href="../../library/#Sunny.ùíÆ"><code>ùíÆ</code></a> is a vector of the three spin operators and <a href="../../library/#Sunny.ùí™"><code>ùí™</code></a> are the symbolic Stevens operators. Here we construct an easy-axis anisotropy.</p><pre><code class="language-julia hljs">D = 2.165
set_anisotropy!(sys, -D*ùíÆ[3]^2, 1)</code></pre><p>The function <a href="../../library/#Sunny.print_anisotropy_as_stevens-Tuple{Any}"><code>print_anisotropy_as_stevens</code></a> will convert an anisotropy operator to a linear combination of Stevens operators.</p><h1 id="Calculating-a-dynamical-spin-structure-factor"><a class="docs-heading-anchor" href="#Calculating-a-dynamical-spin-structure-factor">Calculating a dynamical spin structure factor</a><a id="Calculating-a-dynamical-spin-structure-factor-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-a-dynamical-spin-structure-factor" title="Permalink"></a></h1><p>In the remainder of this tutorial, we will examine Sunny&#39;s tools for calculating structure factors using generalized SU(<em>N</em>) classical dynamics. This is a Monte Carlo calculation and will require the sampling of spin configurations from the Boltzmann distribution at a particular temperature. These samples are then used to generate dynamical trajectories that are analyzed to produce correlation information, i.e., a dynamical structure factor <span>$\mathcal{S}^{\alpha\beta}(\mathbf{q},\omega)$</span>.</p><h2 id="Finding-a-ground-state"><a class="docs-heading-anchor" href="#Finding-a-ground-state">Finding a ground state</a><a id="Finding-a-ground-state-1"></a><a class="docs-heading-anchor-permalink" href="#Finding-a-ground-state" title="Permalink"></a></h2><p>The <a href="../../library/#Sunny.Langevin"><code>Langevin</code></a> dynamics can be used to sample spin configurations in thermal equlibrium.</p><pre><code class="language-julia hljs">E0 = 2.165        # Largest energy scale in the Hamiltonian
Œît = 0.05/E0      # Safe choice for integration step size
Œª = 0.1           # Magnitude of coupling to thermal bath
langevin = Langevin(Œît, 0, Œª);</code></pre><p>Below we use a simulated annealing to find a low-energy configuration. We lower the temperature from <code>E0</code> to <code>0</code> over <code>nsteps</code> of the Langevin dynamics.</p><pre><code class="language-julia hljs">randomize_spins!(sys)
nsteps = 10_000
for kT in range(E0, 0, nsteps)
    langevin.kT = kT
    step!(sys, langevin)
end</code></pre><p>The annealed configuration can be visualized with <code>plot_spins</code>.</p><pre><code class="language-julia hljs">plot_spins(sys; arrowlength=2.5, linewidth=0.75, arrowsize=1.5)</code></pre><p><img src="../fei2_tutorial-28.png" alt/></p><p>There are likely to be defects in the magnetic order because <code>nsteps = 10_000</code> is a relatively fast quench. Repeating the annealing procedure with, say, <code>nsteps = 100_000</code> would likely yield the correct magnetic order. Let&#39;s instead continue with the imperfect one.</p><p>The zero-field energy-minimizing magnetic structure of FeI<span>$_2$</span> is known to be single-<span>$q$</span>. If annealing were perfect, then spontaneous symmetry breaking would select one of <span>$¬±q = [0, -1/4, 1/4]$</span>, <span>$[1/4, 0, 1/4]$</span>, or <span>$[-1/4,1/4,1/4]$</span>. Let us check which modes appear in the static structure factor intensity (for each sublattice independently).</p><pre><code class="language-julia hljs">print_dominant_wavevectors(sys)</code></pre><pre><code class="nohighlight hljs">Dominant wavevectors for spin sublattices:

    [1/4, 0, 1/4]          24.06% weight
    [-1/4, 0, -1/4]        24.06%
    [1/4, 0, 1/2]           7.22%
    [-1/4, 0, 1/2]          7.22%
    [1/4, 0, 0]             5.05%
    [-1/4, 0, 0]            5.05%
    [0, -1/4, 1/4]          2.66%
    [0, 1/4, -1/4]          2.66%
    [0, 1/4, 1/4]           2.34%
    [0, -1/4, -1/4]         2.34%
    [-1/4, 1/4, 1/4]        1.97%
    ...                     ...
</code></pre><p>Let&#39;s break the symmetry by hand. Given a list of <span>$q$</span> modes, Sunny can suggest a magnetic supercell with appropriate periodicity. The result is printed in units of the crystal lattice vectors.</p><pre><code class="language-julia hljs">suggest_magnetic_supercell([[0, -1/4, 1/4]], sys.latsize)</code></pre><pre><code class="nohighlight hljs">Suggested magnetic supercell in multiples of lattice vectors:

    A = [1 0 0; 0 1 -2; 0 1 2]

for wavevectors [[0, -1/4, 1/4]].
</code></pre><p>After reshaping the system to the suggested supercell volume, it becomes much easier to relax the spin configuration.</p><pre><code class="language-julia hljs">A = [1 0 0; 0 1 -2; 0 1 2]
sys_supercell = reshape_volume(sys, A)

randomize_spins!(sys_supercell)
langevin.kT = 0
for i in 1:nsteps
    step!(sys_supercell, langevin)
end

plot_spins(sys_supercell; arrowlength=2.5, linewidth=0.75, arrowsize=1.5)</code></pre><p><img src="../fei2_tutorial-34.png" alt/></p><p>We can now extend this magnetic supercell to a much larger simulation volume.</p><pre><code class="language-julia hljs">sys_large = reshape_volume(sys_supercell, diagm([16,16,4]))
plot_spins(sys_large; arrowlength=2.5, linewidth=0.75, arrowsize=1.5)</code></pre><p><img src="../fei2_tutorial-36.png" alt/></p><h2 id="Calculating-the-structure-factor"><a class="docs-heading-anchor" href="#Calculating-the-structure-factor">Calculating the structure factor</a><a id="Calculating-the-structure-factor-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-the-structure-factor" title="Permalink"></a></h2><p>Apply the Langevin dynamics to thermalize the system to 0.5K. Note that the number of time-steps required to decorrelate may vary significantly for different systems and thermodynamic conditions.</p><pre><code class="language-julia hljs">nsteps_decorr = round(Int, 2.0/Œît)     # System-dependent estimate
kT = 0.5 * meV_per_K            # 0.5K in units of meV
langevin.kT = kT

for _ in 1:5nsteps_decorr
    step!(sys_large, langevin)
end</code></pre><p>With our equilibrated system, we can begin to measure the <a href="../../library/#Sunny.DynamicStructureFactor-Tuple{System}"><code>DynamicStructureFactor</code></a>. Three keyword parameters are required to determine the œâ information that will be calculated: an integration step size, the number of œâs to resolve, and the maximum œâ to resolve. For the time step, twice the value used for the Langevin integrator is usually a good choice.</p><pre><code class="language-julia hljs">sf = DynamicStructureFactor(sys_large; Œît=2Œît, nœâ=120, œâmax=7.5);</code></pre><p><code>sf</code> currently contains dynamical structure data generated from a single sample. Additional samples can be added by generating a new spin configuration and calling <code>add_sample!</code>:</p><pre><code class="language-julia hljs">for _ in 1:2
    for _ in 1:nsteps_decorr        # Generate a new sample spin configuration
        step!(sys_large, langevin)
    end
    add_sample!(sf, sys_large)      # Accumulate the sample into `sf`
end</code></pre><h2 id="Accessing-structure-factor-data"><a class="docs-heading-anchor" href="#Accessing-structure-factor-data">Accessing structure factor data</a><a id="Accessing-structure-factor-data-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-structure-factor-data" title="Permalink"></a></h2><p>The basic function for accessing intensity data is <a href="../../library/#Sunny.intensities-Tuple{StructureFactor, Any, Any}"><code>intensities</code></a>, which, in addition to the structure factor data itself, takes a list of wave vectors and a mode parameter. The options for the mode parameter are <code>:trace</code>, <code>:perp</code> and <code>:full</code> which return, respectively, the trace, the unpolarized intensity, and the full set of matrix elements (correlations of spin components) at the specified wave vectors. For example, we can plot two single-<span>$q$</span> slices as follows.</p><pre><code class="language-julia hljs">qs = [[0, 0, 0], [0.5, 0.5, 0.5]]
is = intensities(sf, qs, :trace; kT)

fig = Figure()
ax = Axis(fig[1,1]; xlabel=&quot;meV&quot;, ylabel=&quot;Intensity&quot;)
l1 = lines!(ax, œâs(sf), is[1,:])
l2 = lines!(ax, œâs(sf), is[2,:])
Legend(fig[1,2], [l1, l2], [&quot;(0,0,0)&quot;, &quot;(œÄ,œÄ,œÄ)&quot;])
fig</code></pre><p><img src="../fei2_tutorial-44.png" alt/></p><p>Note that we provided the optional keyword <code>kT</code> to <code>intensities</code> to enable Sunny to apply a classical-to-quantum rescaling of intensities.</p><p>Frequently we want to extract energy intensities along lines that connect special wave vectors. Sunny provides a function <code>connected_path</code> to makes this easy. The density of sample points can be tuned with a density argument.</p><pre><code class="language-julia hljs">points = [[0.0, 0.0, 0.0],  # List of wave vectors that define a path
          [1.0, 0.0, 0.0],
          [0.0, 1.0, 0.0],
          [0.5, 0.0, 0.0],
          [0.0, 1.0, 0.0],
          [0.0, 0.0, 0.0]]
formfactors = [FormFactor(1, &quot;Fe2&quot;; g_lande=3/2)]  # Ion information for each site to
                                                   # retrieve form factor correction parameters
density = 40
path, markers = connected_path(points, density)

is = intensities(sf, path, :perp;
    interpolation = :linear,       # Interpolate between available wave vectors
    kT,                            # Temperature for intensity correction
    formfactors,                   # Form factor information
)

fig = Figure()
labels = [&quot;($(p[1]),$(p[2]),$(p[3]))&quot; for p in points]
ax = Axis(fig[1,1];
    ylabel = &quot;meV&quot;,
    xticks = (markers, labels),
    xticklabelrotation=œÄ/8,
    xticklabelsize=12,
)
heatmap!(ax, 1:size(is,1), œâs(sf), is; colorrange=(0.0, 0.5))
fig</code></pre><p><img src="../fei2_tutorial-46.png" alt/></p><p>Often it is useful to plot cuts across multiple wave vectors but at a single energy.</p><pre><code class="language-julia hljs">npoints = 60
qvals = range(-2.0, 2.0, length=npoints)
qs = [[a, b, 0.0] for a in qvals, b in qvals]
forfactors = [FormFactor(1, &quot;Fe2&quot;)]

is = intensities(sf, qs, :perp;
    interpolation = :linear,
    kT,
    formfactors,
);

œâidx = 30
œâ = œâs(sf)[œâidx]
fig = Figure()
ax = Axis(fig[1,1]; title=&quot;œâ=$œâ meV&quot;, aspect=true)
hidedecorations!(ax); hidespines!(ax)
hm = heatmap!(ax, is[:,:,œâidx])
Colorbar(fig[1,2], hm)
fig</code></pre><p><img src="../fei2_tutorial-48.png" alt/></p><p>Note that Brillouin zones appear &quot;skewed&quot;. This is a consequence of the fact that our reciprocal lattice vectors are not orthogonal. It is often useful to express our wave vectors in terms of an orthogonal basis, where each basis element is specified as a linear combination of reciprocal lattice vectors. For our crystal, with reciprocal vectors <span>$a^*$</span>, <span>$b^*$</span> and <span>$c^*$</span>, we can define an orthogonal basis by taking <span>$\hat{a}^* = 0.5(a^* + b^*)$</span>, <span>$\hat{b}^*=a^* - b^*$</span>, and <span>$\hat{c}^*=c^*$</span>. Below, we map <code>qs</code> to wavevectors <code>ks</code> in the new coordinate system and get their intensities.</p><pre><code class="language-julia hljs">A = [0.5  1.0 0.0;
     0.5 -1.0 0.0;
     0.0  0.0 1.0]
ks = [A*q for q in qs]

is_ortho = intensities(sf, ks, :perp;
    interpolation = :linear,
    kT,
    formfactors,
);

fig = Figure()
ax = Axis(fig[1,1]; title=&quot;œâ=$œâ meV&quot;, aspect=true)
hidedecorations!(ax); hidespines!(ax)
hm = heatmap!(ax, is_ortho[:,:,œâidx])
Colorbar(fig[1,2], hm)
fig</code></pre><p><img src="../fei2_tutorial-50.png" alt/></p><p>Finally, we note that static structure factor data can be obtained from a dynamic structure factor with <code>static_intensities</code>:</p><pre><code class="language-julia hljs">is_static = static_intensities(sf, ks, :perp;
    interpolation = :linear,
    kT,
    formfactors,
)

fig = Figure()
ax = Axis(fig[1,1]; title=&quot;Static Structure Factor&quot;, aspect=true)
hidedecorations!(ax); hidespines!(ax)
hm = heatmap!(ax, is_static)
Colorbar(fig[1,2], hm)
fig</code></pre><p><img src="../fei2_tutorial-52.png" alt/></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../quick-start/">¬´ Quick Start</a><a class="docs-footer-nextpage" href="../../library/">Library API ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Monday 6 February 2023 21:06">Monday 6 February 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
